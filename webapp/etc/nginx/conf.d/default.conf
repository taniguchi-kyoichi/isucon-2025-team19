server {
  listen 80;

  client_max_body_size 10m;
  root /public/;

  # Enable proxy cache for static files
  proxy_cache_path /var/cache/nginx/static_cache levels=1:2 keys_zone=static_cache:10m max_size=10g inactive=60m use_temp_path=off;

  # Static file caching configuration
  location ~ \.(css|js|ico|jpg|jpeg|png|gif)$ {
    root /public;
    expires 30d;
    add_header Cache-Control "public, no-transform";
    access_log off;
    
    # Cache settings
    proxy_cache static_cache;
    proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
    proxy_cache_valid 200 30d;
    proxy_cache_valid any 1m;
    proxy_cache_min_uses 1;
    
    # Optimization
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
  }

  location / {
    proxy_set_header Host $host;
    proxy_pass http://app:8080;
  }
}
